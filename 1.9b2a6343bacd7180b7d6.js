(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"4w17":function(e,t,n){"use strict";(function(n){var r,i=function(e,t,r){var i;(i=void 0!==n?n:null)&&"undefined"==typeof window&&void 0!==n&&(n.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},n.console||(n.console={}),void 0!==n.console.log&&void 0!==n.console.error||(n.console.error=n.console.log=n.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(i.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},i.HTMLVideoElement=function(){}),"undefined"==typeof location&&(i.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(i.screen={width:0,height:0}),"undefined"==typeof URL&&(i.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),"undefined"==typeof MediaStreamTrack&&(i.MediaStreamTrack=function(){}),void 0===o&&(i.RTCPeerConnection=function(){}),i.window=n);var o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"==typeof MediaStreamTrack&&(MediaStreamTrack={});var a={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},connectionType:{systemNetworkType:((navigator.connection||{}).type||"unknown").toString().toLowerCase(),systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(){d=!0}},s={checkIfOfferer:function(e){"googLibjingleSession"===e.type&&(a.isOfferer=e.googInitiator)}},c=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),u=this;if(!(arguments[0]instanceof o))throw"1st argument is not instance of RTCPeerConnection.";u=arguments[0],arguments[1]instanceof MediaStreamTrack&&(e=arguments[1],t=arguments[2],r=arguments[3]);var d=!1;s.datachannel=function(e){"datachannel"===e.type&&(a.datachannel={state:e.state})},s.googCertificate=function(e){"googCertificate"==e.type&&(a.encryption=e.googFingerprintAlgorithm),"certificate"==e.type&&(a.encryption=e.fingerprintAlgorithm)},s.checkAudioTracks=function(e){if("audio"===e.mediaType){var t=e.id.split("_").pop();if(!0===e.isRemote&&(t="recv"),!1===e.isRemote&&(t="send"),t){if(-1===a.audio[t].codecs.indexOf(e.googCodecName||"opus")&&a.audio[t].codecs.push(e.googCodecName||"opus"),e.bytesSent){var n=0;a.internal.audio[t].prevBytesSent||(a.internal.audio[t].prevBytesSent=e.bytesSent);var r=e.bytesSent-a.internal.audio[t].prevBytesSent;a.internal.audio[t].prevBytesSent=e.bytesSent,a.audio[t].availableBandwidth=(n=r/1024).toFixed(1),a.audio.bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,a.internal.audio[t].prevBytesReceived||(a.internal.audio[t].prevBytesReceived=e.bytesReceived),r=e.bytesReceived-a.internal.audio[t].prevBytesReceived,a.internal.audio[t].prevBytesReceived=e.bytesReceived,a.audio.bytesReceived=(n=r/1024).toFixed(1)),e.googTrackId&&-1===a.audio[t].tracks.indexOf(e.googTrackId)&&a.audio[t].tracks.push(e.googTrackId),e.googCurrentDelayMs&&(n=0,a.internal.audio.prevGoogCurrentDelayMs||(a.internal.audio.prevGoogCurrentDelayMs=e.googCurrentDelayMs),r=e.googCurrentDelayMs-a.internal.audio.prevGoogCurrentDelayMs,a.internal.audio.prevGoogCurrentDelayMs=e.googCurrentDelayMs,a.audio.latency=r.toFixed(1),a.audio.latency<0&&(a.audio.latency=0)),e.packetsLost&&(n=0,a.internal.audio.prevPacketsLost||(a.internal.audio.prevPacketsLost=e.packetsLost),r=e.packetsLost-a.internal.audio.prevPacketsLost,a.internal.audio.prevPacketsLost=e.packetsLost,a.audio.packetsLost=r.toFixed(1),a.audio.packetsLost<0&&(a.audio.packetsLost=0))}}},s.checkVideoTracks=function(e){if("video"===e.mediaType){var t=e.id.split("_").pop();if(!0===e.isRemote&&(t="recv"),!1===e.isRemote&&(t="send"),t){if(-1===a.video[t].codecs.indexOf(e.googCodecName||"VP8")&&a.video[t].codecs.push(e.googCodecName||"VP8"),e.bytesSent){var n=0;a.internal.video[t].prevBytesSent||(a.internal.video[t].prevBytesSent=e.bytesSent);var r=e.bytesSent-a.internal.video[t].prevBytesSent;a.internal.video[t].prevBytesSent=e.bytesSent,a.video[t].availableBandwidth=(n=r/1024).toFixed(1),a.video.bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,a.internal.video[t].prevBytesReceived||(a.internal.video[t].prevBytesReceived=e.bytesReceived),r=e.bytesReceived-a.internal.video[t].prevBytesReceived,a.internal.video[t].prevBytesReceived=e.bytesReceived,a.video.bytesReceived=(n=r/1024).toFixed(1)),e.googFrameHeightReceived&&e.googFrameWidthReceived&&(a.resolutions[t].width=e.googFrameWidthReceived,a.resolutions[t].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(a.resolutions[t].width=e.googFrameWidthSent,a.resolutions[t].height=e.googFrameHeightSent),e.googTrackId&&-1===a.video[t].tracks.indexOf(e.googTrackId)&&a.video[t].tracks.push(e.googTrackId),e.framerateMean&&(a.bandwidth.framerateMean=e.framerateMean,n=0,a.internal.video[t].prevFramerateMean||(a.internal.video[t].prevFramerateMean=e.bitrateMean),r=e.bytesSent-a.internal.video[t].prevFramerateMean,a.internal.video[t].prevFramerateMean=e.framerateMean,n=r/1024,a.video[t].framerateMean=r.toFixed(1)),e.bitrateMean&&(a.bandwidth.bitrateMean=e.bitrateMean,n=0,a.internal.video[t].prevBitrateMean||(a.internal.video[t].prevBitrateMean=e.bitrateMean),r=e.bytesSent-a.internal.video[t].prevBitrateMean,a.internal.video[t].prevBitrateMean=e.bitrateMean,n=r/1024,a.video[t].bitrateMean=r.toFixed(1)),e.googCurrentDelayMs&&(n=0,a.internal.video.prevGoogCurrentDelayMs||(a.internal.video.prevGoogCurrentDelayMs=e.googCurrentDelayMs),r=e.googCurrentDelayMs-a.internal.video.prevGoogCurrentDelayMs,a.internal.video.prevGoogCurrentDelayMs=e.googCurrentDelayMs,a.video.latency=r.toFixed(1),a.video.latency<0&&(a.video.latency=0)),e.packetsLost&&(n=0,a.internal.video.prevPacketsLost||(a.internal.video.prevPacketsLost=e.packetsLost),r=e.packetsLost-a.internal.video.prevPacketsLost,a.internal.video.prevPacketsLost=e.packetsLost,a.video.packetsLost=r.toFixed(1),a.video.packetsLost<0&&(a.video.packetsLost=0))}}},s.bweforvideo=function(e){"VideoBwe"===e.type&&(a.bandwidth.availableSendBandwidth=e.googAvailableSendBandwidth,a.bandwidth.googActualEncBitrate=e.googActualEncBitrate,a.bandwidth.googAvailableSendBandwidth=e.googAvailableSendBandwidth,a.bandwidth.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,a.bandwidth.googRetransmitBitrate=e.googRetransmitBitrate,a.bandwidth.googTargetEncBitrate=e.googTargetEncBitrate,a.bandwidth.googBucketDelay=e.googBucketDelay,a.bandwidth.googTransmitBitrate=e.googTransmitBitrate)},s.candidatePair=function(e){if("googCandidatePair"===e.type||"candidate-pair"===e.type||"local-candidate"===e.type||"remote-candidate"===e.type){if("true"==e.googActiveConnection&&(Object.keys(a.internal.candidates).forEach(function(t){var n=a.internal.candidates[t];-1!==n.ipAddress.indexOf(e.googLocalAddress)&&(a.connectionType.local.candidateType=n.candidateType,a.connectionType.local.ipAddress=n.ipAddress,a.connectionType.local.networkType=n.networkType,a.connectionType.local.transport=n.transport),-1!==n.ipAddress.indexOf(e.googRemoteAddress)&&(a.connectionType.remote.candidateType=n.candidateType,a.connectionType.remote.ipAddress=n.ipAddress,a.connectionType.remote.networkType=n.networkType,a.connectionType.remote.transport=n.transport)}),a.connectionType.transport=e.googTransportType,(t=a.internal.candidates[e.localCandidateId])&&t.ipAddress&&(a.connectionType.systemIpAddress=t.ipAddress),(n=a.internal.candidates[e.remoteCandidateId])&&n.ipAddress&&(a.connectionType.systemIpAddress=n.ipAddress)),"candidate-pair"===e.type&&!0===e.selected&&!0===e.nominated&&"succeeded"===e.state)var t=a.internal.candidates[e.remoteCandidateId],n=a.internal.candidates[e.remoteCandidateId];if("local-candidate"===e.type&&(a.connectionType.local.candidateType=e.candidateType,a.connectionType.local.ipAddress=e.ipAddress,a.connectionType.local.networkType=e.networkType,a.connectionType.local.transport=e.mozLocalTransport||e.transport),"remote-candidate"===e.type&&(a.connectionType.remote.candidateType=e.candidateType,a.connectionType.remote.ipAddress=e.ipAddress,a.connectionType.remote.networkType=e.networkType,a.connectionType.remote.transport=e.mozRemoteTransport||e.transport),c){var r=e.localCandidateId?"send":"recv";if(!r)return;if(e.bytesSent){var i=0;a.internal.video[r].prevBytesSent||(a.internal.video[r].prevBytesSent=e.bytesSent);var o=e.bytesSent-a.internal.video[r].prevBytesSent;a.internal.video[r].prevBytesSent=e.bytesSent,a.video[r].availableBandwidth=(i=o/1024).toFixed(1),a.video.bytesSent=i.toFixed(1)}e.bytesReceived&&(i=0,a.internal.video[r].prevBytesReceived||(a.internal.video[r].prevBytesReceived=e.bytesReceived),o=e.bytesReceived-a.internal.video[r].prevBytesReceived,a.internal.video[r].prevBytesReceived=e.bytesReceived,a.video.bytesReceived=(i=o/1024).toFixed(1)),e.availableOutgoingBitrate&&(i=0,a.internal.video[r].prevAvailableOutgoingBitrate||(a.internal.video[r].prevAvailableOutgoingBitrate=e.availableOutgoingBitrate),o=e.availableOutgoingBitrate-a.internal.video[r].prevAvailableOutgoingBitrate,a.internal.video[r].prevAvailableOutgoingBitrate=e.availableOutgoingBitrate,a.video.availableOutgoingBitrate=(i=o/1024).toFixed(1)),e.availableIncomingBitrate&&(i=0,a.internal.video[r].prevAvailableIncomingBitrate||(a.internal.video[r].prevAvailableIncomingBitrate=e.availableIncomingBitrate),o=e.availableIncomingBitrate-a.internal.video[r].prevAvailableIncomingBitrate,a.internal.video[r].prevAvailableIncomingBitrate=e.availableIncomingBitrate,a.video.availableIncomingBitrate=(i=o/1024).toFixed(1))}}};var l={},p={},f={},h={};s.localcandidate=function(e){"localcandidate"!==e.type&&"local-candidate"!==e.type||e.id&&(l[e.id]||(l[e.id]=[]),p[e.id]||(p[e.id]=[]),f[e.id]||(f[e.id]=[]),h[e.id]||(h[e.id]=[]),e.candidateType&&-1===l[e.id].indexOf(e.candidateType)&&l[e.id].push(e.candidateType),e.transport&&-1===p[e.id].indexOf(e.transport)&&p[e.id].push(e.transport),e.ipAddress&&-1===f[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&f[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===h[e.id].indexOf(e.networkType)&&h[e.id].push(e.networkType),a.internal.candidates[e.id]={candidateType:l[e.id],ipAddress:f[e.id],portNumber:e.portNumber,networkType:h[e.id],priority:e.priority,transport:p[e.id],timestamp:e.timestamp,id:e.id,type:e.type},a.connectionType.local.candidateType=l[e.id],a.connectionType.local.ipAddress=f[e.id],a.connectionType.local.networkType=h[e.id],a.connectionType.local.transport=p[e.id])};var y={},v={},_={},g={};s.remotecandidate=function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||e.id&&(y[e.id]||(y[e.id]=[]),v[e.id]||(v[e.id]=[]),_[e.id]||(_[e.id]=[]),g[e.id]||(g[e.id]=[]),e.candidateType&&-1===y[e.id].indexOf(e.candidateType)&&y[e.id].push(e.candidateType),e.transport&&-1===v[e.id].indexOf(e.transport)&&v[e.id].push(e.transport),e.ipAddress&&-1===_[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&_[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===g[e.id].indexOf(e.networkType)&&g[e.id].push(e.networkType),a.internal.candidates[e.id]={candidateType:y[e.id],ipAddress:_[e.id],portNumber:e.portNumber,networkType:g[e.id],priority:e.priority,transport:v[e.id],timestamp:e.timestamp,id:e.id,type:e.type},a.connectionType.remote.candidateType=y[e.id],a.connectionType.remote.ipAddress=_[e.id],a.connectionType.remote.networkType=g[e.id],a.connectionType.remote.transport=v[e.id])},s.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(a[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(a[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))},s.inboundrtp=function(e){if(c&&"inbound-rtp"===e.type){var t=e.mediaType||"audio",n=e.isRemote?"recv":"send";if(n){if(e.bytesSent){var r=0;a.internal[t][n].prevBytesSent||(a.internal[t][n].prevBytesSent=e.bytesSent);var i=e.bytesSent-a.internal[t][n].prevBytesSent;a.internal[t][n].prevBytesSent=e.bytesSent,a[t][n].availableBandwidth=(r=i/1024).toFixed(1),a[t].bytesSent=r.toFixed(1)}e.bytesReceived&&(r=0,a.internal[t][n].prevBytesReceived||(a.internal[t][n].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-a.internal[t][n].prevBytesReceived,a.internal[t][n].prevBytesReceived=e.bytesReceived,a[t].bytesReceived=(r=i/1024).toFixed(1))}}},s.outboundrtp=function(e){if(c&&"outbound-rtp"===e.type){var t=e.mediaType||"audio",n=e.isRemote?"recv":"send";if(n){if(e.bytesSent){var r=0;a.internal[t][n].prevBytesSent||(a.internal[t][n].prevBytesSent=e.bytesSent);var i=e.bytesSent-a.internal[t][n].prevBytesSent;a.internal[t][n].prevBytesSent=e.bytesSent,a[t][n].availableBandwidth=(r=i/1024).toFixed(1),a[t].bytesSent=r.toFixed(1)}e.bytesReceived&&(r=0,a.internal[t][n].prevBytesReceived||(a.internal[t][n].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-a.internal[t][n].prevBytesReceived,a.internal[t][n].prevBytesReceived=e.bytesReceived,a[t].bytesReceived=(r=i/1024).toFixed(1))}}},s.track=function(e){if(c&&"track"===e.type){var t=!0===e.remoteSource?"send":"recv";e.frameWidth&&e.frameHeight&&(a.resolutions[t].width=e.frameWidth,a.resolutions[t].height=e.frameHeight)}};var b={audio:{send:[],recv:[]},video:{send:[],recv:[]}};s.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();-1===b[e.mediaType][t].indexOf(e.ssrc)&&b[e.mediaType][t].push(e.ssrc),a[e.mediaType][t].streams=b[e.mediaType][t].length}},function e(){var n;n=function(n){if(n&&n.forEach){n.forEach(function(e){Object.keys(s).forEach(function(t){if("function"==typeof s[t])try{s[t](e)}catch(n){console.error(n.message,n.stack,n)}})});try{-1!==u.iceConnectionState.search(/failed|closed|disconnected/gi)&&(d=!0)}catch(i){d=!0}!0===d&&(a.datachannel&&(a.datachannel.state="close"),a.ended=!0),a.results=n,a.audio&&a.video&&(a.bandwidth.speed=a.audio.bytesSent-a.bandwidth.helper.audioBytesSent+(a.video.bytesSent-a.bandwidth.helper.videoBytesSent),a.bandwidth.helper.audioBytesSent=a.audio.bytesSent,a.bandwidth.helper.videoBytesSent=a.video.bytesSent),t(a),d||null!=typeof r&&r&&setTimeout(e,r||1e3)}},void 0!==window.InstallTrigger||c?u.getStats(window.mediaStreamTrack||null).then(function(e){var t=[];e.forEach(function(e){t.push(e)}),n(t)}).catch(n):u.getStats(function(e){var t=[];e.result().forEach(function(e){var n={};e.names().forEach(function(t){n[t]=e.stat(t)}),n.id=e.id,n.type=e.type,n.timestamp=e.timestamp,t.push(n)}),n(t)})}()};e.exports=i,void 0===(r=(function(){return i}).apply(t,[]))||(e.exports=r)}).call(this,n("pCvA"))},"6CUI":function(e,t,n){parcelRequire=function(t,r,i,o){var a="function"==typeof parcelRequire&&parcelRequire;function s(e,i){if(!r[e]){if(!t[e]){var o="function"==typeof parcelRequire&&parcelRequire;if(!i&&o)return o(e,!0);if(a)return a(e,!0);if("string"==typeof e)return n("EAKa")(e);var c=new Error("Cannot find module '"+e+"'");throw c.code="MODULE_NOT_FOUND",c}d.resolve=function(n){return t[e][1][n]||n},d.cache={};var u=r[e]=new s.Module(e);t[e][0].call(u.exports,d,u,u.exports,this)}return r[e].exports;function d(e){return s(d.resolve(e))}}s.isParcelRequire=!0,s.Module=function(e){this.id=e,this.bundle=s,this.exports={}},s.modules=t,s.cache=r,s.parent=a,s.register=function(e,n){t[e]=[function(e,t){t.exports=n},{}]};for(var c=0;c<i.length;c++)s(i[c]);if(i.length){var u=s(i[i.length-1]);e.exports=u}return s}({vHo1:[function(e,t,n){var r={};r.useBlobBuilder=function(){try{return new Blob([]),!1}catch(r){return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(r){return!0}}(),t.exports.binaryFeatures=r;var i=t.exports.BlobBuilder;function o(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(i=t.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),o.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},o.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);r.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},o.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var e=new i,t=0,n=this._parts.length;t<n;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)},t.exports.BufferBuilder=o},{}],lHOc:[function(e,t,n){var r=e("./bufferbuilder").BufferBuilder,i=e("./bufferbuilder").binaryFeatures;function o(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function a(){this.bufferBuilder=new r}function s(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}t.exports={unpack:function(e){return new o(e).unpack()},pack:function(e){var t=new a;return t.pack(e),t.getBuffer()}},o.prototype.unpack=function(){var e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},o.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},o.prototype.unpack_uint16=function(){var e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t},o.prototype.unpack_uint32=function(){var e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t},o.prototype.unpack_uint64=function(){var e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t},o.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},o.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},o.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},o.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},o.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},o.prototype.unpack_string=function(e){for(var t,n,r=this.read(e),i=0,o="";i<e;)(t=r[i])<128?(o+=String.fromCharCode(t),i++):(192^t)<32?(n=(192^t)<<6|63&r[i+1],o+=String.fromCharCode(n),i+=2):(n=(15&t)<<12|(63&r[i+1])<<6|63&r[i+2],o+=String.fromCharCode(n),i+=3);return this.index+=e,o},o.prototype.unpack_array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this.unpack();return t},o.prototype.unpack_map=function(e){for(var t={},n=0;n<e;n++){var r=this.unpack(),i=this.unpack();t[r]=i}return t},o.prototype.unpack_float=function(){var e=this.unpack_uint32();return(0==e>>31?1:-1)*(8388607&e|8388608)*Math.pow(2,(e>>23&255)-127-23)},o.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),n=(e>>20&2047)-1023;return(0==e>>31?1:-1)*((1048575&e|1048576)*Math.pow(2,n-20)+t*Math.pow(2,n-52))},o.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},a.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},a.prototype.pack=function(e){var t=typeof e;if("string"==t)this.pack_string(e);else if("number"==t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"==t)!0===e?this.bufferBuilder.append(195):!1===e&&this.bufferBuilder.append(194);else if("undefined"==t)this.bufferBuilder.append(192);else{if("object"!=t)throw new Error('Type "'+t+'" not yet supported');if(null===e)this.bufferBuilder.append(192);else{var n=e.constructor;if(n==Array)this.pack_array(e);else if(n==Blob||n==File)this.pack_bin(e);else if(n==ArrayBuffer)this.pack_bin(i.useArrayBufferView?new Uint8Array(e):e);else if("BYTES_PER_ELEMENT"in e)this.pack_bin(i.useArrayBufferView?new Uint8Array(e.buffer):e.buffer);else if(n==Object)this.pack_object(e);else if(n==Date)this.pack_string(e.toString());else{if("function"!=typeof e.toBinaryPack)throw new Error('Type "'+n.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},a.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},a.prototype.pack_string=function(e){var t=function(e){return e.length>600?new Blob([e]).size:e.replace(/[^\u0000-\u007F]/g,s).length}(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},a.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var n=0;n<t;n++)this.pack(e[n])},a.prototype.pack_integer=function(e){if(-32<=e&&e<=127)this.bufferBuilder.append(255&e);else if(0<=e&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(-128<=e&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(0<=e&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(-32768<=e&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(0<=e&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(-2147483648<=e&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(-0x8000000000000000<=e&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(0<=e&&e<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},a.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var n=Math.floor(Math.log(e)/Math.LN2),r=e/Math.pow(2,n)-1,i=Math.floor(r*Math.pow(2,52)),o=Math.pow(2,32),a=t<<31|n+1023<<20|i/o&1048575,s=i%o;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(s)},a.prototype.pack_object=function(e){var t=Object.keys(e).length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(t)}for(var n in e)e.hasOwnProperty(n)&&(this.pack(n),this.pack(e[n]))},a.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},a.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_uint32=function(e){var t=4294967295&e;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},a.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)},a.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},a.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)}},{"./bufferbuilder":"vHo1"}],sXtV:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,n.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],BHXf:[function(e,t,n){var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("js-binarypack")),o=e("./adapter"),a={iceServers:[{urls:"stun:stun.l.google.com:19302"}],sdpSemantics:"unified-plan"},s=function(){function e(){}var t;return e.noop=function(){},e.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},e.chunk=function(t){for(var n,r=[],i=t.size,o=Math.ceil(i/e.chunkedMTU),a=n=0;a<i;){var s=Math.min(i,a+e.chunkedMTU),c=t.slice(a,s);r.push({__peerData:this._dataCount,n:n,data:c,total:o}),a=s,n++}return this._dataCount++,r},e.blobToArrayBuffer=function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)},e.blobToBinaryString=function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsBinaryString(e)},e.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer},e.randomToken=function(){return Math.random().toString(36).substr(2)},e.isSecure=function(){return"https:"===location.protocol},e.CLOUD_HOST="0.peerjs.com",e.CLOUD_PORT=443,e.chunkedBrowsers={Chrome:1},e.chunkedMTU=16300,e.defaultConfig=a,e.browser=(t=window).mozRTCPeerConnection?"Firefox":t.webkitRTCPeerConnection?"Chrome":t.RTCPeerConnection?"Supported":"Unsupported",e.supports=function(){if(void 0===o.RTCPeerConnection)return{};var e,t,n=!0,r=!0,i=!1,s=!1,c=!!window.webkitRTCPeerConnection;try{e=new o.RTCPeerConnection(a,{optional:[{RtpDataChannels:!0}]})}catch(d){n=!1,r=!1}if(n)try{t=e.createDataChannel("_PEERJSTEST")}catch(d){n=!1}if(n){try{t.binaryType="blob",i=!0}catch(d){}var u=new o.RTCPeerConnection(a,{});try{s=u.createDataChannel("_PEERJSRELIABLETEST",{}).ordered}catch(d){}u.close()}return r&&(r=!!e.addStream),e&&e.close(),{audioVideo:r,data:n,binaryBlob:i,binary:s,reliable:s,sctp:s,onnegotiationneeded:c}}(),e.pack=i.pack,e.unpack=i.unpack,e._dataCount=1,e}();n.util=s},{"js-binarypack":"lHOc","./adapter":"sXtV"}],"2JJl":[function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||e,o),c=i?i+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=this._events[i?i+e:e];if(!t)return[];if(t.fn)return[t.fn];for(var n=0,r=t.length,o=new Array(r);n<r;n++)o[n]=t[n].fn;return o},u.prototype.listenerCount=function(e){var t=this._events[i?i+e:e];return t?t.fn?1:t.length:0},u.prototype.emit=function(e,t,n,r,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var c,u,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,r),!0;case 5:return d.fn.call(d.context,t,n,r,o),!0;case 6:return d.fn.call(d.context,t,n,r,o,a),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var p,f=d.length;for(u=0;u<f;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,n);break;case 4:d[u].fn.call(d[u].context,t,n,r);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];d[u].fn.apply(d[u].context,c)}}return!0},u.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,r){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return c(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||c(this,o);else{for(var s=0,u=[],d=a.length;s<d;s++)(a[s].fn!==t||r&&!a[s].once||n&&a[s].context!==n)&&u.push(a[s]);u.length?this._events[o]=1===u.length?u[0]:u:c(this,o)}return this},u.prototype.removeAllListeners=function(e){var t;return e?this._events[t=i?i+e:e]&&c(this,t):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,void 0!==t&&(t.exports=u)},{}],"8WOs":[function(e,t,n){"use strict";var r,i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"}(r=n.LogLevel||(n.LogLevel={}));var a=function(){function e(){this._logLevel=r.Disabled}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!0,configurable:!0}),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=r.All&&this._print.apply(this,o([r.All],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=r.Warnings&&this._print.apply(this,o([r.Warnings],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=r.Errors&&this._print.apply(this,o([r.Errors],e))},e.prototype.setLogFunction=function(e){this._print=e},e.prototype._print=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=o(["PeerJS: "],t);for(var a in i)i[a]instanceof Error&&(i[a]="("+i[a].name+") "+i[a].message);e>=r.All?console.log.apply(console,o(i)):e>=r.Warnings?console.warn.apply(console,o(["WARNING"],i)):e>=r.Errors&&console.error.apply(console,o(["ERROR"],i))},e}();n.default=new a},{}],"9ZRY":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.Open="open",e.Stream="stream",e.Data="data",e.Close="close",e.Error="error",e.IceStateChanged="iceStateChanged"}(n.ConnectionEventType||(n.ConnectionEventType={})),function(e){e.Data="data",e.Media="media"}(n.ConnectionType||(n.ConnectionType={})),function(e){e.Open="open",e.Close="close",e.Connection="connection",e.Call="call",e.Disconnected="disconnected",e.Error="error"}(n.PeerEventType||(n.PeerEventType={})),function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"}(n.PeerErrorType||(n.PeerErrorType={})),function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"}(n.SerializationType||(n.SerializationType={})),function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"}(n.SocketEventType||(n.SocketEventType={})),function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"}(n.ServerMessageType||(n.ServerMessageType={}))},{}],wJlv:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(d){i={error:d}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("eventemitter3"),u=s(e("./logger")),d=e("./enums"),l=function(e){function t(t,n,r,i,o){var a=e.call(this)||this;return a.WEB_SOCKET_PING_INTERVAL=2e4,a._disconnected=!1,a._messagesQueue=[],a._wsUrl=(t?"wss://":"ws://")+n+":"+r+i+"peerjs?key="+o,a}return r(t,e),t.prototype.start=function(e,t){this._id=e,this._wsUrl+="&id="+e+"&token="+t,this._startWebSocket()},t.prototype._startWebSocket=function(){var e=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(t){var n;try{n=JSON.parse(t.data)}catch(a){return void u.default.log("Invalid server message",t.data)}e.emit(d.SocketEventType.Message,n)},this._socket.onclose=function(t){u.default.log("Socket closed.",t),e._disconnected=!0,clearTimeout(e._wsPingTimer),e.emit(d.SocketEventType.Disconnected)},this._socket.onopen=function(){e._disconnected||(e._sendQueuedMessages(),u.default.log("Socket open"),e._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.WEB_SOCKET_PING_INTERVAL)},t.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:d.ServerMessageType.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else u.default.log("Cannot send heartbeat, because socket closed")},t.prototype._wsOpen=function(){return!!this._socket&&1==this._socket.readyState},t.prototype._sendQueuedMessages=function(){var e,t,n=o(this._messagesQueue);this._messagesQueue=[];try{for(var r=a(n),i=r.next();!i.done;i=r.next())this.send(i.value)}catch(l){e={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.send=function(e){if(!this._disconnected)if(this._id)if(e.type){if(this._wsOpen()){var t=JSON.stringify(e);this._socket.send(t)}}else this.emit(d.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(e)},t.prototype.close=function(){!this._disconnected&&this._socket&&(this._socket.close(),this._disconnected=!0,clearTimeout(this._wsPingTimer))},t}(c.EventEmitter);n.Socket=l},{eventemitter3:"2JJl","./logger":"8WOs","./enums":"9ZRY"}],T9kO:[function(e,t,n){var r=e("js-binarypack"),i={debug:!1,inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},pack:r.pack,unpack:r.unpack,log:function(){if(i.debug){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.unshift("Reliable: "),console.log.apply(console,e)}},setZeroTimeout:function(e){var t=[],n="zero-timeout-message";function r(r){r.source==e&&r.data==n&&(r.stopPropagation&&r.stopPropagation(),t.length&&t.shift()())}return e.addEventListener?e.addEventListener("message",r,!0):e.attachEvent&&e.attachEvent("onmessage",r),function(r){t.push(r),e.postMessage(n,"*")}}(this),blobToArrayBuffer:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)},blobToBinaryString:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};t.exports=i},{"js-binarypack":"lHOc"}],aYFJ:[function(e,t,n){var r=e("./util");function i(e,t){if(!(this instanceof i))return new i(e);this._dc=e,r.debug=t,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC()}i.prototype.send=function(e){var t=r.pack(e);t.size<this._mtu?this._handleSend(["no",t]):(this._outgoing[this._count]={ack:0,chunks:this._chunk(t)},r.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1)},i.prototype._setupInterval=function(){var e=this;this._timeout=setInterval(function(){var t=e._queue.shift();if(t._multiple)for(var n=0,r=t.length;n<r;n+=1)e._intervalSend(t[n]);else e._intervalSend(t)},this._interval)},i.prototype._intervalSend=function(e){var t=this;e=r.pack(e),r.blobToBinaryString(e,function(e){t._dc.send(e)}),0===t._queue.length&&(clearTimeout(t._timeout),t._timeout=null)},i.prototype._processAcks=function(){for(var e in this._outgoing)this._outgoing.hasOwnProperty(e)&&this._sendWindowedChunks(e)},i.prototype._handleSend=function(e){for(var t=!0,n=0,r=this._queue.length;n<r;n+=1){var i=this._queue[n];i===e?t=!1:i._multiple&&-1!==i.indexOf(e)&&(t=!1)}t&&(this._queue.push(e),this._timeout||this._setupInterval())},i.prototype._setupDC=function(){var e=this;this._dc.onmessage=function(t){var n=t.data;if(n.constructor===String){var i=r.binaryStringToArrayBuffer(n);n=r.unpack(i),e._handleMessage(n)}}},i.prototype._handleMessage=function(e){var t,n=e[1],i=this._incoming[n],o=this._outgoing[n];switch(e[0]){case"no":n&&this.onmessage(r.unpack(n));break;case"end":if(t=i,this._received[n]=e[2],!t)break;this._ack(n);break;case"ack":(t=o)&&(t.ack=Math.max(e[2],t.ack),t.ack>=t.chunks.length?(r.log("Time: ",new Date-t.timer),delete this._outgoing[n]):this._processAcks());break;case"chunk":if(!(t=i)){if(!0===this._received[n])break;this._incoming[n]=t={ack:["ack",n,0],chunks:[]}}var a=e[2];t.chunks[a]=new Uint8Array(e[3]),a===t.ack[2]&&this._calculateNextAck(n),this._ack(n);break;default:this._handleSend(e)}},i.prototype._chunk=function(e){for(var t=[],n=e.size,i=0;i<n;){var o=Math.min(n,i+this._mtu),a={payload:e.slice(i,o)};t.push(a),i=o}return r.log("Created",t.length,"chunks."),t},i.prototype._ack=function(e){var t=this._incoming[e].ack;this._received[e]===t[2]&&(this._complete(e),this._received[e]=!0),this._handleSend(t)},i.prototype._calculateNextAck=function(e){for(var t=this._incoming[e],n=t.chunks,r=0,i=n.length;r<i;r+=1)if(void 0===n[r])return void(t.ack[2]=r);t.ack[2]=n.length},i.prototype._sendWindowedChunks=function(e){r.log("sendWindowedChunks for: ",e);for(var t=this._outgoing[e],n=t.chunks,i=[],o=Math.min(t.ack+this._window,n.length),a=t.ack;a<o;a+=1)n[a].sent&&a!==t.ack||(n[a].sent=!0,i.push(["chunk",e,a,n[a].payload]));t.ack+this._window>=n.length&&i.push(["end",e,n.length]),i._multiple=!0,this._handleSend(i)},i.prototype._complete=function(e){r.log("Completed called for",e);var t=this,n=new Blob(this._incoming[e].chunks);r.blobToArrayBuffer(n,function(e){t.onmessage(r.unpack(e))}),delete this._incoming[e]},i.higherBandwidthSDP=function(e){var t=navigator.appVersion.match(/Chrome\/(.*?) /);if(t&&(t=parseInt(t[1].split(".").shift()))<31){var n=e.split("b=AS:30");if(n.length>1)return n[0]+"b=AS:102400"+n[1]}return e},i.prototype.onmessage=function(e){},t.exports=i},{"./util":"T9kO"}],HCdX:[function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=a(e("reliable")),u=e("./util"),d=s(e("./logger")),l=e("./adapter"),p=e("./enums"),f=function(){function e(e){this.connection=e}return e.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===p.ConnectionType.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===p.ConnectionType.Data){var n=this.connection,r={};u.util.supports.sctp||(r={reliable:e.reliable});var i=t.createDataChannel(n.label,r);n.initialize(i)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},e.prototype._startPeerConnection=function(){d.default.log("Creating RTCPeerConnection.");var e={};this.connection.type!==p.ConnectionType.Data||u.util.supports.sctp?this.connection.type===p.ConnectionType.Media&&(e={optional:[{DtlsSrtpKeyAgreement:!0}]}):e={optional:[{RtpDataChannels:!0}]};var t=new l.RTCPeerConnection(this.connection.provider.options.config,e);return this._setupListeners(t),t},e.prototype._setupListeners=function(e){var t=this,n=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,o=this.connection.provider;d.default.log("Listening for ICE candidates."),e.onicecandidate=function(e){e.candidate&&(d.default.log("Received ICE candidates for:",n),o.socket.send({type:p.ServerMessageType.Candidate,payload:{candidate:e.candidate,type:i,connectionId:r},dst:n}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":d.default.log("iceConnectionState is failed, closing connections to "+n),t.connection.emit(p.ConnectionEventType.Error,new Error("Negotiation of connection to "+n+" failed.")),t.connection.close();break;case"closed":d.default.log("iceConnectionState is closed, closing connections to "+n),t.connection.emit(p.ConnectionEventType.Error,new Error("Negotiation of connection to "+n+" failed.")),t.connection.close();break;case"disconnected":d.default.log("iceConnectionState is disconnected, closing connections to "+n);break;case"completed":e.onicecandidate=u.util.noop}t.connection.emit(p.ConnectionEventType.IceStateChanged,e.iceConnectionState)},d.default.log("Listening for data channel"),e.ondatachannel=function(e){d.default.log("Received data channel");var t=e.channel;o.getConnection(n,r).initialize(t)},d.default.log("Listening for remote stream"),e.ontrack=function(e){d.default.log("Received remote stream");var i=e.streams[0],a=o.getConnection(n,r);a.type===p.ConnectionType.Media&&t._addStreamToMediaConnection(i,a)}},e.prototype.cleanup=function(){d.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t=!1;if(this.connection.type===p.ConnectionType.Data){var n=this.connection.dataChannel;t=n.readyState&&"closed"!==n.readyState}("closed"!==e.signalingState||t)&&e.close()}},e.prototype._makeOffer=function(){return i(this,void 0,Promise,function(){var e,t,n,i,a,s,l;return o(this,function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:n=o.sent(),d.default.log("Created offer."),u.util.supports.sctp||this.connection.type!==p.ConnectionType.Data||(a=this.connection).reliable&&(n.sdp=c.higherBandwidthSDP(n.sdp)),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(n)];case 4:return o.sent(),d.default.log("Set localDescription:",n,"for:"+this.connection.peer),i={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:u.util.browser},this.connection.type===p.ConnectionType.Data&&(i=r({},i,{label:(a=this.connection).label,reliable:a.reliable,serialization:a.serialization})),t.socket.send({type:p.ServerMessageType.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(s=o.sent())&&(t.emitError(p.PeerErrorType.WebRTC,s),d.default.log("Failed to setLocalDescription, ",s)),[3,6];case 6:return[3,8];case 7:return l=o.sent(),t.emitError(p.PeerErrorType.WebRTC,l),d.default.log("Failed to createOffer, ",l),[3,8];case 8:return[2]}})})},e.prototype._makeAnswer=function(){return i(this,void 0,Promise,function(){var e,t,n,r,i;return o(this,function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:n=o.sent(),d.default.log("Created answer."),u.util.supports.sctp||this.connection.type!==p.ConnectionType.Data||this.connection.reliable&&(n.sdp=c.higherBandwidthSDP(n.sdp)),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(n)];case 4:return o.sent(),d.default.log("Set localDescription:",n,"for:"+this.connection.peer),t.socket.send({type:p.ServerMessageType.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:u.util.browser},dst:this.connection.peer}),[3,6];case 5:return r=o.sent(),t.emitError(p.PeerErrorType.WebRTC,r),d.default.log("Failed to setLocalDescription, ",r),[3,6];case 6:return[3,8];case 7:return i=o.sent(),t.emitError(p.PeerErrorType.WebRTC,i),d.default.log("Failed to create answer, ",i),[3,8];case 8:return[2]}})})},e.prototype.handleSDP=function(e,t){return i(this,void 0,Promise,function(){var n,r,i,a;return o(this,function(o){switch(o.label){case 0:t=new l.RTCSessionDescription(t),n=this.connection.peerConnection,r=this.connection.provider,d.default.log("Setting remote description",t),i=this,o.label=1;case 1:return o.trys.push([1,5,,6]),[4,n.setRemoteDescription(t)];case 2:return o.sent(),d.default.log("Set remoteDescription:"+e+" for:"+this.connection.peer),"OFFER"!==e?[3,4]:[4,i._makeAnswer()];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:return a=o.sent(),r.emitError(p.PeerErrorType.WebRTC,a),d.default.log("Failed to setRemoteDescription, ",a),[3,6];case 6:return[2]}})})},e.prototype.handleCandidate=function(e){return i(this,void 0,Promise,function(){var t,n,r,i,a;return o(this,function(o){switch(o.label){case 0:t=e.candidate,n=e.sdpMLineIndex,r=this.connection.peerConnection,i=this.connection.provider,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,r.addIceCandidate(new l.RTCIceCandidate({sdpMLineIndex:n,candidate:t}))];case 2:return o.sent(),d.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return a=o.sent(),i.emitError(p.PeerErrorType.WebRTC,a),d.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},e.prototype._addTracksToConnection=function(e,t){if(d.default.log("add tracks from stream "+e.id+" to peer connection"),!t.addTrack)return d.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(n){t.addTrack(n,e)})},e.prototype._addStreamToMediaConnection=function(e,t){d.default.log("add stream "+e.id+" to media connection "+t.connectionId),t.addStream(e)},e}();n.Negotiator=f},{reliable:"aYFJ","./util":"BHXf","./logger":"8WOs","./adapter":"sXtV","./enums":"9ZRY"}],tQFK:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(e){function t(t,n,r){var i=e.call(this)||this;return i.peer=t,i.provider=n,i.options=r,i._open=!1,i.metadata=r.metadata,i}return r(t,e),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),t}(e("eventemitter3").EventEmitter);n.BaseConnection=i},{eventemitter3:"2JJl"}],dbHP:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./util"),c=a(e("./logger")),u=e("./negotiator"),d=e("./enums"),l=function(e){function t(n,r,i){var o=e.call(this,n,r,i)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||t.ID_PREFIX+s.util.randomToken(),o._negotiator=new u.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return r(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return d.ConnectionType.Media},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!0,configurable:!0}),t.prototype.addStream=function(t){c.default.log("Receiving stream",t),this._remoteStream=t,e.prototype.emit.call(this,d.ConnectionEventType.Stream,t)},t.prototype.handleMessage=function(e){var t=e.type,n=e.payload;switch(e.type){case d.ServerMessageType.Answer:this._negotiator.handleSDP(t,n.sdp),this._open=!0;break;case d.ServerMessageType.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:c.default.warn("Unrecognized message type:"+t+" from peer:"+this.peer)}},t.prototype.answer=function(e){var t,n;if(this._localStream)c.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,this._negotiator.startConnection(i({},this.options._payload,{_stream:e}));var r=this.provider._getMessages(this.connectionId);try{for(var a=o(r),s=a.next();!s.done;s=a.next())this.handleMessage(s.value)}catch(u){t={error:u}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this._open=!0}},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,d.ConnectionEventType.Close))},t.ID_PREFIX="mc_",t}(e("./baseconnection").BaseConnection);n.MediaConnection=l},{"./util":"BHXf","./logger":"8WOs","./negotiator":"HCdX","./enums":"9ZRY","./baseconnection":"tQFK"}],GBTQ:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(n,"__esModule",{value:!0});var a=e("reliable"),s=e("./util"),c=o(e("./logger")),u=e("./negotiator"),d=e("./enums"),l=function(e){function t(n,r,i){var o=e.call(this,n,r,i)||this;return o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o.connectionId=o.options.connectionId||t.ID_PREFIX+s.util.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||d.SerializationType.Binary,o.reliable=o.options.reliable,o.options._payload&&(o._peerBrowser=o.options._payload.browser),o._negotiator=new u.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return r(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return d.ConnectionType.Data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!0,configurable:!0}),t.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var e=this;s.util.supports.sctp&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){c.default.log("Data channel connection success"),e._open=!0,e.emit(d.ConnectionEventType.Open)},!s.util.supports.sctp&&this.reliable&&(this._reliable=new a.Reliable(this.dataChannel,c.default.logLevel>c.LogLevel.Disabled)),this._reliable?this._reliable.onmessage=function(t){e.emit(d.ConnectionEventType.Data,t)}:this.dataChannel.onmessage=function(t){e._handleDataMessage(t)},this.dataChannel.onclose=function(){c.default.log("DataChannel closed for:",e.peer),e.close()}},t.prototype._handleDataMessage=function(t){var n=this,r=t.data,i=r.constructor;if(this.serialization===d.SerializationType.Binary||this.serialization===d.SerializationType.BinaryUTF8){if(i===Blob)return void s.util.blobToArrayBuffer(r,function(e){r=s.util.unpack(e),n.emit(d.ConnectionEventType.Data,r)});if(i===ArrayBuffer)r=s.util.unpack(r);else if(i===String){var o=s.util.binaryStringToArrayBuffer(r);r=s.util.unpack(o)}}else this.serialization===d.SerializationType.JSON&&(r=JSON.parse(r));if(r.__peerData){var a=r.__peerData,c=this._chunkedData[a]||{data:[],count:0,total:r.total};return c.data[r.n]=r.data,c.count++,c.total===c.count&&(delete this._chunkedData[a],r=new Blob(c.data),this._handleDataMessage({data:r})),void(this._chunkedData[a]=c)}e.prototype.emit.call(this,d.ConnectionEventType.Data,r)},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.open&&(this._open=!1,e.prototype.emit.call(this,d.ConnectionEventType.Close))},t.prototype.send=function(t,n){var r=this;if(this.open)if(this._reliable)this._reliable.send(t);else if(this.serialization===d.SerializationType.JSON)this._bufferedSend(JSON.stringify(t));else if(this.serialization===d.SerializationType.Binary||this.serialization===d.SerializationType.BinaryUTF8){var i=s.util.pack(t);if((s.util.chunkedBrowsers[this._peerBrowser]||s.util.chunkedBrowsers[s.util.browser])&&!n&&i.size>s.util.chunkedMTU)return void this._sendChunks(i);s.util.supports.sctp?s.util.supports.binaryBlob?this._bufferedSend(i):s.util.blobToArrayBuffer(i,function(e){r._bufferedSend(e)}):s.util.blobToBinaryString(i,function(e){r._bufferedSend(e)})}else this._bufferedSend(t);else e.prototype.emit.call(this,d.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},t.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(t){var n=this;if(!this.open)return!1;try{this.dataChannel.send(t)}catch(e){return this._buffering=!0,setTimeout(function(){n._buffering=!1,n._tryBuffer()},100),!1}return!0},t.prototype._tryBuffer=function(){this.open&&0!==this._buffer.length&&this._trySend(this._buffer[0])&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())},t.prototype._sendChunks=function(e){var t,n,r=s.util.chunk(e);try{for(var o=i(r),a=o.next();!a.done;a=o.next())this.send(a.value,!0)}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},t.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case d.ServerMessageType.Answer:this._peerBrowser=t.browser,this._negotiator.handleSDP(e.type,t.sdp);break;case d.ServerMessageType.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:c.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},t.ID_PREFIX="dc_",t}(e("./baseconnection").BaseConnection);n.DataConnection=l},{reliable:"aYFJ","./util":"BHXf","./logger":"8WOs","./negotiator":"HCdX","./enums":"9ZRY","./baseconnection":"tQFK"}],in7L:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./util"),s=o(e("./logger")),c=function(){function e(e){this._options=e}return e.prototype._buildUrl=function(e){return(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+e+"?ts="+(new Date).getTime()+Math.random()},e.prototype.retrieveId=function(){return r(this,void 0,Promise,function(){var e,t,n,r;return i(this,function(i){switch(i.label){case 0:e=this._buildUrl("id"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch(e)];case 2:if(200!==(t=i.sent()).status)throw new Error("Error. Status:"+t.status);return[2,t.text()];case 3:throw n=i.sent(),s.default.error("Error retrieving ID",n),r="","/"===this._options.path&&this._options.host!==a.util.CLOUD_HOST&&(r=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+r);case 4:return[2]}})})},e.prototype.listAllPeers=function(){return r(this,void 0,Promise,function(){var e,t,n;return i(this,function(r){switch(r.label){case 0:e=this._buildUrl("peers"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch(e)];case 2:if(200!==(t=r.sent()).status){if(401===t.status)throw new Error("It doesn't look like you have permission to list peers IDs. "+(this._options.host===a.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature."));throw new Error("Error. Status:"+t.status)}return[2,t.json()];case 3:throw n=r.sent(),s.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 4:return[2]}})})},e}();n.API=c},{"./util":"BHXf","./logger":"8WOs"}],Hxpd:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(d){i={error:d}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("eventemitter3"),u=e("./util"),d=s(e("./logger")),l=e("./socket"),p=e("./mediaconnection"),f=e("./dataconnection"),h=e("./enums"),y=e("./api"),v=function(e){function t(n,r){var o=e.call(this)||this;return o._destroyed=!1,o._disconnected=!1,o._open=!1,o._connections=new Map,o._lostMessages=new Map,n&&n.constructor==Object?(r=n,n=void 0):n&&(n=n.toString()),r=i({debug:0,host:u.util.CLOUD_HOST,port:u.util.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:u.util.randomToken(),config:u.util.defaultConfig},r),o._options=r,"/"===r.host&&(r.host=window.location.hostname),"/"!==r.path[0]&&(r.path="/"+r.path),"/"!==r.path[r.path.length-1]&&(r.path+="/"),void 0===r.secure&&r.host!==u.util.CLOUD_HOST?r.secure=u.util.isSecure():r.host==u.util.CLOUD_HOST&&(r.secure=!0),r.logFunction&&d.default.setLogFunction(r.logFunction),d.default.logLevel=r.debug,u.util.supports.audioVideo||u.util.supports.data?u.util.validateId(n)?(o._api=new y.API(r),o._initializeServerConnection(),n?o._initialize(n):o._api.retrieveId().then(function(e){return o._initialize(e)}).catch(function(e){return o._abort(h.PeerErrorType.ServerError,e)}),o):(o._delayedAbort(h.PeerErrorType.InvalidID,'ID "'+n+'" is invalid'),o):(o._delayedAbort(h.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),o)}return r(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var e,t,n=Object.create(null);try{for(var r=o(this._connections),i=r.next();!i.done;i=r.next()){var s=a(i.value,2);n[s[0]]=s[1]}}catch(f){e={error:f}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!0,configurable:!0}),t.prototype._initializeServerConnection=function(){var e=this;this._socket=new l.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key),this.socket.on(h.SocketEventType.Message,function(t){e._handleMessage(t)}),this.socket.on(h.SocketEventType.Error,function(t){e._abort(h.PeerErrorType.SocketError,t)}),this.socket.on(h.SocketEventType.Disconnected,function(){e.disconnected||(e.emitError(h.PeerErrorType.Network,"Lost connection to server."),e.disconnect())}),this.socket.on(h.SocketEventType.Close,function(){e.disconnected||e._abort(h.PeerErrorType.SocketClosed,"Underlying socket is already closed.")})},t.prototype._initialize=function(e){this._id=e,this.socket.start(this.id,this._options.token)},t.prototype._handleMessage=function(e){var t,n,r=e.type,i=e.payload,a=e.src;switch(r){case h.ServerMessageType.Open:this.emit(h.PeerEventType.Open,this.id),this._open=!0;break;case h.ServerMessageType.Error:this._abort(h.PeerErrorType.ServerError,i.msg);break;case h.ServerMessageType.IdTaken:this._abort(h.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case h.ServerMessageType.InvalidKey:this._abort(h.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case h.ServerMessageType.Leave:d.default.log("Received leave message from",a),this._cleanupPeer(a),this._connections.delete(a);break;case h.ServerMessageType.Expire:this.emitError(h.PeerErrorType.PeerUnavailable,"Could not connect to peer "+a);break;case h.ServerMessageType.Offer:var s=i.connectionId;if((y=this.getConnection(a,s))&&(y.close(),d.default.warn("Offer received for existing Connection ID:",s)),i.type===h.ConnectionType.Media)y=new p.MediaConnection(a,this,{connectionId:s,_payload:i,metadata:i.metadata}),this._addConnection(a,y),this.emit(h.PeerEventType.Call,y);else{if(i.type!==h.ConnectionType.Data)return void d.default.warn("Received malformed connection type:",i.type);y=new f.DataConnection(a,this,{connectionId:s,_payload:i,metadata:i.metadata,label:i.label,serialization:i.serialization,reliable:i.reliable}),this._addConnection(a,y),this.emit(h.PeerEventType.Connection,y)}var c=this._getMessages(s);try{for(var u=o(c),l=u.next();!l.done;l=u.next())y.handleMessage(l.value)}catch(v){t={error:v}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}break;default:if(!i)return void d.default.warn("You received a malformed message from "+a+" of type "+r);var y;(y=this.getConnection(a,s=i.connectionId))&&y.peerConnection?y.handleMessage(e):s?this._storeMessage(s,e):d.default.warn("You received an unrecognized message:",e)}},t.prototype._storeMessage=function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)},t.prototype._getMessages=function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]},t.prototype.connect=function(e,t){if(void 0===t&&(t={}),this.disconnected)return d.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(h.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var n=new f.DataConnection(e,this,t);return this._addConnection(e,n),n},t.prototype.call=function(e,t,n){if(void 0===n&&(n={}),this.disconnected)return d.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(h.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(t){n._stream=t;var r=new p.MediaConnection(e,this,n);return this._addConnection(e,r),r}d.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},t.prototype._addConnection=function(e,t){d.default.log("add connection "+t.type+":"+t.connectionId+"\n       to peerId:"+e),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)},t.prototype._removeConnection=function(e){var t=this._connections.get(e.peer);if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}this._lostMessages.delete(e.connectionId)},t.prototype.getConnection=function(e,t){var n,r,i=this._connections.get(e);if(!i)return null;try{for(var a=o(i),s=a.next();!s.done;s=a.next()){var c=s.value;if(c.connectionId===t)return c}}catch(p){n={error:p}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return null},t.prototype._delayedAbort=function(e,t){var n=this;setTimeout(function(){n._abort(e,t)},0)},t.prototype._abort=function(e,t){d.default.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(e,t)},t.prototype.emitError=function(e,t){d.default.error("Error:",t),"string"==typeof t&&(t=new Error(t)),t.type=e,this.emit(h.PeerEventType.Error,t)},t.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this._destroyed=!0)},t.prototype._cleanup=function(){var e,t;try{for(var n=o(this._connections.keys()),r=n.next();!r.done;r=n.next()){var i=r.value;this._cleanupPeer(i),this._connections.delete(i)}}catch(u){e={error:u}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.emit(h.PeerEventType.Close)},t.prototype._cleanupPeer=function(e){var t,n,r=this._connections.get(e);if(r)try{for(var i=o(r),a=i.next();!a.done;a=i.next())a.value.close()}catch(d){t={error:d}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},t.prototype.disconnect=function(){var e=this;setTimeout(function(){e.disconnected||(e._disconnected=!0,e._open=!1,e.socket&&e.socket.close(),e.emit(h.PeerEventType.Disconnected,e.id),e._lastServerId=e.id,e._id=null)},0)},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)d.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");d.default.error("In a hurry? We're still trying to make the initial connection!")}},t.prototype.listAllPeers=function(e){var t=this;void 0===e&&(e=function(e){}),this._api.listAllPeers().then(function(t){return e(t)}).catch(function(e){return t._abort(h.PeerErrorType.ServerError,e)})},t.DEFAULT_KEY="peerjs",t}(c.EventEmitter);n.Peer=v},{eventemitter3:"2JJl","./util":"BHXf","./logger":"8WOs","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"9ZRY","./api":"in7L"}],iTK6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util"),i=e("./peer");n.peerjs={Peer:i.Peer,util:r.util},n.default=i.Peer,window.peerjs=n.peerjs,window.Peer=i.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"])},EAKa:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="EAKa"},JLJU:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("bb6g"),i=n("9h0M"),o=n("keVe"),a=function(){function e(e){this.http=e,this.nodeAddress="http://localhost:5001",this.nodeAddress2="http://localhost:5002",this.httpOptions={headers:new i.g({"Content-Type":"application/json"})}}return e.prototype.getChannels=function(e,t){return r.b(this,void 0,void 0,function(){return r.e(this,function(n){switch(n.label){case 0:return[4,this.http.get(this.nodeAddress2+"/api/v1/channels/"+e+"/"+t).toPromise()];case 1:return[2,n.sent()]}})})},e.prototype.createChannel=function(e,t,n){return r.b(this,void 0,void 0,function(){return r.e(this,function(r){switch(r.label){case 0:return[4,this.http.put(this.nodeAddress+"/api/v1/channels",{partner_address:t,token_address:e,total_deposit:n,settle_timeout:500},this.httpOptions).toPromise()];case 1:return[2,r.sent()]}})})},e.prototype.updateChannel=function(e,t,n){return r.b(this,void 0,void 0,function(){return r.e(this,function(r){switch(r.label){case 0:return[4,this.http.patch(this.nodeAddress+"/api/v1/channels/"+e+"/"+t,{total_deposit:n},this.httpOptions).toPromise()];case 1:return[2,r.sent()]}})})},e.prototype.pay=function(e,t,n){return r.b(this,void 0,void 0,function(){return r.e(this,function(r){switch(r.label){case 0:return[4,this.http.post(this.nodeAddress+"/api/v1/payments/"+e+"/"+t,{amount:n},this.httpOptions).toPromise()];case 1:return[2,r.sent()]}})})},e.ngInjectableDef=o.R({factory:function(){return new e(o.V(i.c))},token:e,providedIn:"root"}),e}()}}]);